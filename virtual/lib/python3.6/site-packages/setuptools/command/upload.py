<<<<<<< HEAD
import getpass
=======
>>>>>>> d6f1d5e162ab24ff2bbae41214684f7dea3134f6
from distutils.command import upload as orig


class upload(orig.upload):
    """
<<<<<<< HEAD
    Override default upload behavior to obtain password
    in a variety of different ways.
=======
    Override default upload behavior to look up password
    in the keyring if available.
>>>>>>> d6f1d5e162ab24ff2bbae41214684f7dea3134f6
    """

    def finalize_options(self):
        orig.upload.finalize_options(self)
<<<<<<< HEAD
        # Attempt to obtain password. Short circuit evaluation at the first
        # sign of success.
        self.password = (
            self.password or
            self._load_password_from_keyring() or
            self._prompt_for_password()
        )
=======
        self.password or self._load_password_from_keyring()
>>>>>>> d6f1d5e162ab24ff2bbae41214684f7dea3134f6

    def _load_password_from_keyring(self):
        """
        Attempt to load password from keyring. Suppress Exceptions.
        """
        try:
            keyring = __import__('keyring')
<<<<<<< HEAD
            return keyring.get_password(self.repository, self.username)
        except Exception:
            pass

    def _prompt_for_password(self):
        """
        Prompt for a password on the tty. Suppress Exceptions.
        """
        try:
            return getpass.getpass()
        except (Exception, KeyboardInterrupt):
            pass
=======
            self.password = keyring.get_password(self.repository,
                self.username)
        except Exception:
            pass
>>>>>>> d6f1d5e162ab24ff2bbae41214684f7dea3134f6
